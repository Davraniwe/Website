# Static Site Server

Этот проект содержит статический сервер на Node.js, который по умолчанию слушает порт `1001` и раздаёт файлы из подкаталогов внутри репозитория. Текущий сайт расположен в директории `cancero.tech/`.

## Быстрый запуск
1. Убедитесь, что установлен Node.js (версия 16+).
2. Установите зависимости: `npm install`.
3. (Опционально) подготовьте файл `.env` с настройками SMTP (см. ниже).
4. Выполните `./start.sh`.
5. Сервер доступен по адресу [http://localhost:1001](http://localhost:1001). При необходимости смотрите логи в файле `server.log`.

Скрипт `start.sh` перед запуском автоматически освобождает порт `1001`, если его занимает предыдущий сервер.

## Ручной запуск
1. Убедитесь, что порт `1001` свободен (например, `lsof -i :1001`).
2. Запустите `node server.js`.
3. Чтобы процесс продолжил работу после закрытия терминала, используйте `nohup node server.js > server.log 2>&1 &`.

## Остановка
- `./stop.sh` корректно завершает процессы, которые слушают порт `1001`.
- Либо остановите вручную (например, `pkill -f "node server.js"`).

## Проверка работоспособности
- Локально: `curl -I http://localhost:1001`
- Удалённо: откройте [http://194.31.175.182:1001/](http://194.31.175.182:1001/)

## Структура
- `cancero.tech/` — файлы сайта cancero.tech (HTML, CSS, JS, изображения и т.д.).
- `server.js` — Node.js сервер для статической выдачи.
- `start.sh` / `stop.sh` — вспомогательные скрипты для управления сервером.
- `server.log` — вывод сервера при запуске через `start.sh` или `nohup` (не отслеживается Git, находится в корне).
- `.env` — необязательный файл с приватными переменными окружения (SMTP, порт и пр.).

## Настройка отправки заявок
Фронтенд отправляет данные формы на эндпоинт `POST /api/contact`. Сервер использует `nodemailer`, поэтому необходимо указать рабочий SMTP. По умолчанию письма уходят на `topoj@bk.ru` (изменяется переменной `CONTACT_RECIPIENT`).

### Пример для почты Mail.ru (пароль приложения)

1. Войдите в аккаунт Mail.ru → **Настройки** → **Безопасность** → **Пароли приложений**.
2. Создайте пароль для «Почта, другое приложение» — запишите сгенерированную строку.
3. Скопируйте `.env.example` → `.env` и заполните значения:

```env
CONTACT_SMTP_HOST=smtp.mail.ru
CONTACT_SMTP_PORT=465
CONTACT_SMTP_SECURE=true
CONTACT_SMTP_USER=topoj@bk.ru
CONTACT_SMTP_PASS=<пароль_приложения_Mail.ru>
CONTACT_FROM="Cancer Resistance <topoj@bk.ru>"
CONTACT_RECIPIENT=topoj@bk.ru
```

Дополнительно поддерживаются переменные:

- `CONTACT_TRANSPORT_URL` — готовая URL-строка для `nodemailer` (альтернатива параметрам выше).
- `CONTACT_USE_SENDMAIL=true` — переключение на системный `sendmail` (если настроен на сервере). Путь можно задать через `SENDMAIL_PATH`.
- `CONTACT_TIMEZONE` — часовой пояс для отметки времени в письме (по умолчанию `Europe/Moscow`).
- `PORT` — порт HTTP сервера (по умолчанию `1001`).

После изменения `.env` перезапустите сервер (`./stop.sh && ./start.sh`). При отсутствии настроек отправки сервер вернёт 500-ошибку, а форма покажет сообщение, что заявка не отправлена.

## Добавление нового сайта
1. Создайте каталог с именем домена будущего сайта (например, `example.com/`).
2. Поместите в него `index.html` и остальные ресурсы (`css/`, `js/`, `assets/` и т.д.).
3. При запуске сервера запросы с заголовком `Host` вида `example.com` будут обслуживаться из этого каталога. Для локальной отладки добавьте запись в `hosts`, например `127.0.0.1 example.com`.
4. Если домен не найден, сервер вернёт содержимое каталога `cancero.tech/` как сайт по умолчанию.
